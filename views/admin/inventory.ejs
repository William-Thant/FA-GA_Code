<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="/theme.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    body { 
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
      min-height: 100vh;
      color: #ffffff;
    }
    .page-header { 
      background: linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #ff3333 100%);
      color: white; 
      padding: 60px 0; 
      margin-bottom: 40px;
      border-bottom: 3px solid #ff3333;
      box-shadow: 0 10px 40px rgba(255, 51, 51, 0.3);
    }
    .page-header h1 {
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 3px;
      font-size: 2.5rem;
      text-shadow: 0 0 20px rgba(255, 51, 51, 0.5);
    }
    .page-header p {
      color: #a8a8a8;
      letter-spacing: 1px;
      font-weight: 500;
      font-size: 1.1rem;
    }
    .product-image { 
      width: 80px; 
      height: 60px; 
      object-fit: cover; 
      border-radius: 8px;
      border: 2px solid #333;
      transition: all 0.3s ease;
    }
    .product-image:hover {
      border-color: #ff3333;
      transform: scale(1.1);
    }
    .table-card { 
      background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
      border: 2px solid #333;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      padding: 0;
      overflow: hidden;
      margin-bottom: 30px;
      transition: all 0.3s ease;
    }
    .table-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 50px rgba(255, 51, 51, 0.3);
      border-color: #ff3333;
    }
    .table-card h5 {
      color: #ffffff;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 2px;
      background: linear-gradient(135deg, #ff3333 0%, #cc0000 100%);
      padding: 20px 30px;
      margin: 0;
      border: none;
    }
    .search-card {
      background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
      border: 2px solid #333;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      margin-bottom: 30px;
      transition: all 0.3s ease;
    }
    .search-card:hover {
      border-color: #ff3333;
      box-shadow: 0 10px 30px rgba(255, 51, 51, 0.2);
    }
    .card-body {
      background: #0a0a0a !important;
      padding: 30px;
    }
    .form-control, .form-select {
      background: #1a1a1a;
      border: 2px solid #333;
      color: #ffffff;
      border-radius: 10px;
      padding: 12px;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    .form-control:focus, .form-select:focus {
      background: #1a1a1a;
      border-color: #ff3333;
      color: #ffffff;
      box-shadow: 0 0 15px rgba(255, 51, 51, 0.3);
    }
    .form-control::placeholder {
      color: #888;
      opacity: 1;
    }
    .form-select option {
      background: #1a1a1a;
      color: #ffffff;
    }
    .table {
      color: #ffffff;
      background: transparent !important;
      margin: 0;
    }
    .table thead th {
      background: transparent !important;
      color: white;
      border: none;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-size: 0.9rem;
      font-weight: 700;
      padding: 20px 15px;
    }
    .table tbody tr {
      border-bottom: 1px solid #333;
      background: #1a1a1a !important;
      transition: all 0.3s ease;
    }
    .table tbody tr:hover {
      background: #2d2d2d !important;
      transform: translateX(5px);
      box-shadow: inset 5px 0 0 #ff3333;
    }
    .table tbody td {
      padding: 15px;
      color: #ffffff !important;
      vertical-align: middle;
      border: none;
    }
    .table tbody td a {
      color: #ffffff !important;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    .table tbody td a:hover {
      color: #ff6666 !important;
      text-shadow: 0 0 10px rgba(255, 51, 51, 0.5);
    }
    .table tbody td small {
      color: #888 !important;
    }
    .alert {
      border-radius: 15px;
      border: 2px solid;
      font-weight: 600;
    }
    .alert-danger {
      background: rgba(255, 51, 51, 0.2);
      border-color: #ff3333;
      color: #ffffff;
    }
    .alert-success {
      background: rgba(39, 174, 96, 0.2);
      border-color: #27ae60;
      color: #ffffff;
    }
    .btn-close {
      filter: invert(1);
    }
    .btn-racing {
      background: linear-gradient(135deg, #ff3333 0%, #cc0000 100%);
      border: none;
      color: #ffffff !important;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      padding: 12px 25px;
      border-radius: 10px;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(255, 51, 51, 0.3);
    }
    .btn-racing:hover {
      background: linear-gradient(135deg, #cc0000 0%, #990000 100%);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(255, 51, 51, 0.5);
      color: white;
    }
    .btn-gold {
      background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
      border: none;
      color: white;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      padding: 12px 25px;
      border-radius: 10px;
      transition: all 0.3s ease;
    }
    .btn-gold:hover {
      background: linear-gradient(135deg, #495057 0%, #343a40 100%);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(108, 117, 125, 0.5);
      color: white;
    }
    .btn-outline-secondary {
      border: 2px solid #333;
      color: #ccc;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      transition: all 0.3s ease;
    }
    .btn-outline-secondary:hover {
      background: #333;
      border-color: #ff3333;
      color: #ffffff;
    }
    .btn-sm {
      padding: 8px 15px;
      font-size: 0.85rem;
    }
    .badge {
      font-weight: 700;
      padding: 8px 15px;
      border-radius: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #000000 !important;
    }
    .fw-bold a {
      color: #ffffff;
      text-decoration: none;
      transition: all 0.3s ease;
      font-weight: 600;
    }
    .fw-bold a:hover {
      color: #ff6666;
      text-shadow: 0 0 10px rgba(255, 51, 51, 0.5);
    }
    .text-success {
      color: #ffffff !important;
      font-weight: 600;
    }
    .text-warning {
      color: #f39c12 !important;
      font-weight: 600;
    }
    .text-danger {
      color: #e74c3c !important;
      font-weight: 600;
    }
  </style>
  <title>Vehicle Inventory - Isaac's Cardealership</title>
</head>
<body>
<%- include('../partials/navbar') %>

<div class="page-header">
  <div class="container">
    <h1><i class="fas fa-warehouse"></i> üèéÔ∏è VEHICLE INVENTORY</h1>
    <p class="mb-0">Manage your dealership showroom catalog</p>
  </div>
</div>

<div class="container pb-5">
  <% if (typeof messages !== 'undefined' && messages) { %>
    <% if (messages.error && messages.error.length) { %>
      <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-circle"></i> <%= messages.error.join ? messages.error.join(', ') : messages.error %>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    <% } %>
    <% if (messages.success && messages.success.length) { %>
      <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fas fa-check-circle"></i> <%= messages.success.join ? messages.success.join(', ') : messages.success %>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    <% } %>
  <% } %>
  
  <!-- Search and Filter Form -->
  <form method="GET" action="/inventory" class="search-card mb-4">
    <div class="card-body p-4">
      <div class="row g-3">
        <div class="col-md-4">
          <input type="text" name="search" class="form-control" placeholder="Search vehicles..." value="<%= typeof search !== 'undefined' ? search : '' %>">
        </div>
        <div class="col-md-3">
          <select name="category" class="form-select">
            <option value="">All Categories</option>
            <% if (typeof categories !== 'undefined' && categories.length > 0) { %>
              <% categories.forEach(cat => { %>
                <% if (cat.category) { %>
                  <option value="<%= cat.category %>" <%= (typeof selectedCategory !== 'undefined' && selectedCategory === cat.category) ? 'selected' : '' %>><%= cat.category %></option>
                <% } %>
              <% }); %>
            <% } %>
          </select>
        </div>
        <div class="col-md-3">
          <select name="sort" class="form-select">
            <option value="">Sort By</option>
            <option value="name_asc" <%= (typeof selectedSort !== 'undefined' && selectedSort === 'name_asc') ? 'selected' : '' %>>Name (A-Z)</option>
            <option value="name_desc" <%= (typeof selectedSort !== 'undefined' && selectedSort === 'name_desc') ? 'selected' : '' %>>Name (Z-A)</option>
            <option value="stock_high" <%= (typeof selectedSort !== 'undefined' && selectedSort === 'stock_high') ? 'selected' : '' %>>Stock (High-Low)</option>
            <option value="stock_low" <%= (typeof selectedSort !== 'undefined' && selectedSort === 'stock_low') ? 'selected' : '' %>>Stock (Low-High)</option>
          </select>
        </div>
        <div class="col-md-2">
          <button type="submit" class="btn btn-gold w-100"><i class="fas fa-search"></i> Apply</button>
          <% if ((typeof search !== 'undefined' && search) || (typeof selectedCategory !== 'undefined' && selectedCategory) || (typeof selectedSort !== 'undefined' && selectedSort)) { %>
            <a href="/inventory" class="btn btn-outline-secondary w-100 mt-2"><i class="fas fa-times"></i> Clear</a>
          <% } %>
        </div>
      </div>
    </div>
  </form>

  <div class="mb-4">
    <a href="/addProduct" class="btn btn-racing btn-lg"><i class="fas fa-plus-circle"></i> Add New Vehicle</a>
  </div>

  <div class="table-card">
    <h5><i class="fas fa-list"></i> Vehicles (<%= products.length %>)</h5>
    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead>
          <tr>
            <th>Image</th>
            <th>Vehicle Name</th>
            <th class="text-center">Stock</th>
            <th class="text-end">Price</th>
            <th class="text-center">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% if (products.length === 0) { %>
            <tr><td colspan="5" class="text-center py-5" style="color: #a8a8a8;"><i class="fas fa-inbox fa-3x mb-3 d-block"></i>No vehicles in inventory</td></tr>
          <% } else { %>
            <% for(let i=0; i < products.length; i++) { %>
              <tr>
                <td>
                  <% if (products[i].image) { %>
                    <img src="images/<%= products[i].image %>" class="product-image" alt="<%= products[i].productName %>">
                  <% } else { %>
                    <div class="product-image bg-dark d-flex align-items-center justify-content-center" style="border-color: #333;"><i class="fas fa-image" style="color: #666;"></i></div>
                  <% } %>
                </td>
                <td>
                  <a href="/product/<%= products[i].id %>" class="text-decoration-none fw-bold"><%= products[i].productName %></a>
                  <% if (products[i].category) { %>
                    <br><small style="color: #a8a8a8;"><i class="fas fa-tag"></i> <%= products[i].category %></small>
                  <% } %>
                </td>
                <td class="text-center">
                  <span class="badge <%= products[i].quantity > 10 ? 'bg-success' : (products[i].quantity > 0 ? 'bg-warning' : 'bg-danger') %>">
                    <%= products[i].quantity %>
                  </span>
                </td>
                <td class="text-end fw-bold text-success">$<%= products[i].price.toFixed(2) %></td>
                <td class="text-center">
                  <a href="/deleteProduct/<%= products[i].id %>" class="btn btn-sm btn-racing"><i class="fas fa-trash"></i> Delete</a>
                </td>
              </tr>
            <% } %>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>
</div>
</body>
</html>
